<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        * {
            padding: 0;
            margin: 0
        }
    </style>
    <script src="pixi.min.js"></script>
</head>
<body>
    
</body>
<script>
    let Application = PIXI.Application,
        loader = PIXI.loader,
        resources = PIXI.loader.resources,
        Sprite = PIXI.Sprite,
        Graphics = PIXI.Graphics,
        Text = PIXI.Text,
        TextStyle = PIXI.TextStyle,
        Container = PIXI.Container;

    let app = new Application({
        width: 512,
        height: 512,                       
        antialias: true,
        transparent: false,
        resolution: 1
    })

    document.body.appendChild(app.view)

    loader
        .add("./cat.png")
        .load(setup)
    
    let cat,x,y,bullets=[];

    function setup() {
        cat = new Sprite(loader.resources["./cat.png"].texture);
        cat.pivot.x = cat.width / 2;
        cat.pivot.y = cat.height / 2;

        cat.x = app.screen.width / 2 - cat.x/2;
        cat.y = app.screen.height / 2 - cat.y/2;


        box = new Graphics();
        box.beginFill(0x66CCFF);
        box.drawRect(0, 0, 512, 512);
        box.endFill();
        box.x = 0;
        box.y = 0;
        app.stage.addChild(box);


        app.stage.addChild(cat);
        app.stage.interactive = true;
        app.stage.on('mousemove', rotation);
        app.stage.on('mousedown', shoot);
          
        app.ticker.add((delta) => {
            cat.rotation = rotateToPoint(x, y, cat.position.x, cat.position.y);
            bullets.forEach(circle => {
                circle.x += circle.vx
                circle.y += circle.vy
            })
        });
    }

    function rotation(event) {
        x = event.data.global.x;
        y = event.data.global.y;
    }

    function shoot(e) {
        let circle = new Graphics();
        circle.beginFill(0x9966FF);
        circle.drawCircle(0, 0, 10);
        circle.endFill();
        circle.x = cat.position.x;
        circle.y = cat.position.y;
        // 分析 子弹移动方向可以根据 cat 的旋转角度计算
        circle.vx = 2 * Math.cos(cat.rotation);
        circle.vy = 2 * Math.sin(cat.rotation);
        bullets.push(circle)
        app.stage.addChild(circle);
    }

    function rotateToPoint(mx, my, px, py){  
        var self = this;
        var dist_Y = my - py;
        var dist_X = mx - px;
        var angle = Math.atan2(dist_Y,dist_X);
        // var degrees = angle * 180/ Math.PI;
        return angle;   
    }
</script>
</html>